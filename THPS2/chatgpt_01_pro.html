<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pokemon-Inspired Mini Game</title>
  <style>
    /* =========================================
       GLOBAL RESETS & SIMPLE STYLES
    ========================================== */
    * {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
      font-family: sans-serif;
    }
    body {
      display: flex; 
      flex-direction: column; 
      align-items: center;
      justify-content: flex-start;
      background: #fafafa;
      color: #333;
      height: 100vh;
      overflow: hidden;
    }
    h1, h2, h3, p {
      margin: 0.5em 0;
    }
    button {
      cursor: pointer;
      border: none;
      padding: 0.5em 1em;
      margin: 0.2em;
      border-radius: 4px;
      background-color: #aaa;
      color: #fff;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #888;
    }

    /* =========================================
       MAIN GAME AREA
    ========================================== */
    #game-container {
      position: relative;
      width: 800px;
      height: 480px;
      background: #66bb6a; /* A nice green grassy color */
      overflow: hidden;
      border: 2px solid #444;
      margin-top: 0.5em;
    }

    /* "Map" floor tiles style (simple squares) */
    .tile {
      position: absolute;
      width: 40px;
      height: 40px;
      background: #8bc34a; /* Slightly different green tile color */
      border: 1px solid #66bb6a;
    }

    /* Trainer sprite (square placeholder) */
    #trainer {
      position: absolute;
      width: 40px;
      height: 40px;
      transform: translate(0, 0);
      transition: transform 0.1s linear;
    }

    /* Add a simple trainer "facing" style using an SVG or shape */
    #trainer svg {
      width: 100%;
      height: 100%;
    }

    /* =========================================
       OVERWORLD DIALOG / MESSAGE BOX
    ========================================== */
    #dialog {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(255,255,255, 0.9);
      padding: 0.5em;
      font-size: 1em;
      display: none;
    }
    #dialog p {
      margin: 0.5em 0;
    }

    /* =========================================
       BATTLE SCREEN
    ========================================== */
    #battle-screen {
      position: absolute;
      top: 0; 
      left: 0;
      width: 100%;
      height: 100%;
      background: #dcedc8; /* Light green background */
      display: none;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
    }
    /* Battle monster display area */
    .monster-display {
      display: flex;
      width: 100%;
      justify-content: space-around;
      align-items: center;
      flex: 1;
    }
    .monster {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .monster svg {
      width: 120px;
      height: 120px;
    }
    /* HP bar */
    .hp-bar-outer {
      width: 150px;
      height: 12px;
      background: #888;
      border: 2px solid #555;
      margin-top: 0.5em;
      position: relative;
    }
    .hp-bar-inner {
      height: 100%;
      background: #4caf50;
      width: 100%;
      transition: width 0.2s;
    }
    /* Battle options */
    #battle-options {
      display: flex;
      justify-content: center;
    }
    /* Text output / announcements */
    #battle-text {
      margin-bottom: 1em;
      min-height: 2em;
    }

    /* =========================================
       CATCH ANIMATION (simple flash)
    ========================================== */
    @keyframes flash {
      0% { background: #fff; opacity: 0.8; }
      50% { background: #ff0; opacity: 1; }
      100% { background: #fff; opacity: 0.8; }
    }
    .flash {
      animation: flash 0.5s ease-in-out 2;
    }
  </style>
</head>
<body>

<h1>Pokemon-Inspired Mini Game (HTML/CSS/JS)</h1>
<p>Use Arrow Keys (↑ ↓ ← →) to move around. When you see a message, press Enter (or click) to advance. Step on tiles to trigger random encounters!</p>

<div id="game-container">
  <!-- TILES: We'll generate them with JS, 20 x 12 grid (40px each) -->
  <div id="trainer">
    <!-- Simple trainer sprite as an inline SVG -->
    <svg viewBox="0 0 100 100">
      <circle cx="50" cy="40" r="15" fill="#ffcc80" stroke="#444" stroke-width="2"/>
      <rect x="35" y="55" width="30" height="40" fill="#2196f3"/>
      <rect x="45" y="80" width="10" height="15" fill="#fff"/>
    </svg>
  </div>
  <!-- Dialog for messages on overworld -->
  <div id="dialog">
    <p id="dialog-text"></p>
  </div>

  <!-- Battle Screen -->
  <div id="battle-screen">
    <div class="monster-display">
      <!-- Opponent monster -->
      <div class="monster" id="opponent-monster">
        <!-- Will insert monster name in <h3> and HP bar, etc. -->
        <h3>Opponent</h3>
        <div class="svg-container"></div>
        <div class="hp-bar-outer">
          <div class="hp-bar-inner"></div>
        </div>
      </div>
      <!-- Player's "active" monster placeholder (if we had party) -->
      <div class="monster" id="player-monster">
        <h3>Your Monster</h3>
        <div class="svg-container"></div>
        <div class="hp-bar-outer">
          <div class="hp-bar-inner"></div>
        </div>
      </div>
    </div>
    <div id="battle-text"></div>
    <div id="battle-options">
      <button id="btn-attack">Attack</button>
      <button id="btn-catch">Catch</button>
      <button id="btn-run">Run</button>
    </div>
  </div>
</div>

<script>
/* 
  =========================================================
  SIMPLE POKEMON-INSPIRED GAME
  =========================================================
  - Overworld with arrow key movement on tiles
  - Random encounters
  - Simple turn-based battle
  - Attempt to catch the wild monster
  - No external dependencies, single-file approach
*/

/* GLOBAL GAME STATE */
const GAME = {
  trainerPosition: { x: 0, y: 0 },
  gridCols: 20,
  gridRows: 12,
  tileSize: 40,
  inDialog: false,
  inBattle: false,
  monsterList: [
    {
      name: 'Flamester',
      maxHp: 50,
      svg: `<svg viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="40" fill="orange" stroke="red" stroke-width="5"/>
              <path d="M30,70 Q50,10 70,70" fill="yellow" />
            </svg>`
    },
    {
      name: 'Aquabeast',
      maxHp: 55,
      svg: `<svg viewBox="0 0 100 100">
              <rect x="20" y="20" width="60" height="60" rx="10" ry="10" fill="lightblue" stroke="blue" stroke-width="5"/>
              <circle cx="40" cy="40" r="5" fill="white"/>
              <circle cx="60" cy="40" r="5" fill="white"/>
            </svg>`
    },
    {
      name: 'Electrix',
      maxHp: 45,
      svg: `<svg viewBox="0 0 100 100">
              <polygon points="50,10 40,40 70,40 30,90 60,60 40,60" fill="yellow" stroke="gold" stroke-width="3"/>
            </svg>`
    }
  ],
  playerMonster: {
    name: 'Leafbuddy',
    maxHp: 50,
    currentHp: 50,
    svg: `<svg viewBox="0 0 100 100">
            <path d="M50,10 C30,30 30,70 50,90 C70,70 70,30 50,10" fill="green" stroke="darkgreen" stroke-width="4"/>
          </svg>`
  },
  inventory: {
    pokeballs: 5
  }
};

/* DOM ELEMENTS */
const container = document.getElementById('game-container');
const dialogEl = document.getElementById('dialog');
const dialogTextEl = document.getElementById('dialog-text');
const trainerEl = document.getElementById('trainer');
const battleScreenEl = document.getElementById('battle-screen');
const opponentMonsterEl = document.getElementById('opponent-monster');
const playerMonsterEl = document.getElementById('player-monster');
const battleTextEl = document.getElementById('battle-text');
const btnAttack = document.getElementById('btn-attack');
const btnCatch = document.getElementById('btn-catch');
const btnRun = document.getElementById('btn-run');

/* CREATE TILES FOR THE OVERWORLD */
function createTiles() {
  for (let r = 0; r < GAME.gridRows; r++) {
    for (let c = 0; c < GAME.gridCols; c++) {
      const tile = document.createElement('div');
      tile.classList.add('tile');
      tile.style.left = (c * GAME.tileSize) + 'px';
      tile.style.top = (r * GAME.tileSize) + 'px';
      container.appendChild(tile);
    }
  }
}
createTiles();

/* POSITION TRAINER */
function updateTrainerPosition() {
  trainerEl.style.transform = `translate(${GAME.trainerPosition.x * GAME.tileSize}px, ${GAME.trainerPosition.y * GAME.tileSize}px)`;
}

/* MOVEMENT & RANDOM ENCOUNTERS */
document.addEventListener('keydown', (e) => {
  if (GAME.inDialog || GAME.inBattle) {
    // If in a dialog or battle, pressing Enter will close the dialog or proceed
    if (e.key === 'Enter') {
      closeDialog();
    }
    return;
  }

  let moved = false;
  let dx = 0;
  let dy = 0;

  if (e.key === 'ArrowUp')    { dy = -1; moved = true; }
  if (e.key === 'ArrowDown')  { dy = 1;  moved = true; }
  if (e.key === 'ArrowLeft')  { dx = -1; moved = true; }
  if (e.key === 'ArrowRight') { dx = 1;  moved = true; }

  if (moved) {
    const newX = GAME.trainerPosition.x + dx;
    const newY = GAME.trainerPosition.y + dy;
    if (newX >= 0 && newX < GAME.gridCols && newY >= 0 && newY < GAME.gridRows) {
      GAME.trainerPosition.x = newX;
      GAME.trainerPosition.y = newY;
      updateTrainerPosition();
      // Random encounter chance
      if (Math.random() < 0.2) {
        // ~20% chance
        startEncounter();
      }
    }
  }
});

/* SIMPLE DIALOG HANDLING */
function openDialog(text) {
  dialogEl.style.display = 'block';
  dialogTextEl.textContent = text;
  GAME.inDialog = true;
}
function closeDialog() {
  dialogEl.style.display = 'none';
  GAME.inDialog = false;
}

/* RANDOM ENCOUNTER */
function startEncounter() {
  // Choose a random monster
  const randomIndex = Math.floor(Math.random() * GAME.monsterList.length);
  const wildMonster = JSON.parse(JSON.stringify(GAME.monsterList[randomIndex]));
  wildMonster.currentHp = wildMonster.maxHp;

  // Enter battle
  enterBattle(wildMonster);
}

/* BATTLE LOGIC */
let currentOpponent = null;

function enterBattle(opponent) {
  GAME.inBattle = true;
  currentOpponent = opponent;
  // Show battle screen
  battleScreenEl.style.display = 'flex';
  // Initialize monster DOM
  opponentMonsterEl.querySelector('h3').textContent = opponent.name;
  opponentMonsterEl.querySelector('.svg-container').innerHTML = opponent.svg;
  updateHpBar(opponentMonsterEl.querySelector('.hp-bar-inner'), opponent.currentHp, opponent.maxHp);

  // Player monster
  playerMonsterEl.querySelector('h3').textContent = GAME.playerMonster.name;
  playerMonsterEl.querySelector('.svg-container').innerHTML = GAME.playerMonster.svg;
  updateHpBar(playerMonsterEl.querySelector('.hp-bar-inner'), GAME.playerMonster.currentHp, GAME.playerMonster.maxHp);

  battleTextEl.textContent = `A wild ${opponent.name} appeared!`;
}

/* Update HP bar width */
function updateHpBar(barEl, current, max) {
  const pct = Math.max(0, Math.floor((current / max) * 100));
  barEl.style.width = pct + '%';
}

/* Attack handler */
btnAttack.addEventListener('click', () => {
  if (!GAME.inBattle) return;
  // Player attacks
  const dmg = getRandomInt(5, 12);
  currentOpponent.currentHp -= dmg;
  battleTextEl.textContent = `You dealt ${dmg} damage to ${currentOpponent.name}!`;
  updateHpBar(opponentMonsterEl.querySelector('.hp-bar-inner'), currentOpponent.currentHp, currentOpponent.maxHp);
  checkOpponentFainted();
  if (GAME.inBattle) {
    // Opponent counterattacks
    setTimeout(() => {
      const enemyDmg = getRandomInt(4, 10);
      GAME.playerMonster.currentHp -= enemyDmg;
      battleTextEl.textContent += ` The wild ${currentOpponent.name} dealt ${enemyDmg} damage back!`;
      updateHpBar(playerMonsterEl.querySelector('.hp-bar-inner'), GAME.playerMonster.currentHp, GAME.playerMonster.maxHp);
      checkPlayerFainted();
    }, 700);
  }
});

/* Catch handler */
btnCatch.addEventListener('click', () => {
  if (!GAME.inBattle) return;
  if (GAME.inventory.pokeballs <= 0) {
    battleTextEl.textContent = `You have no capture balls left!`;
    return;
  }
  GAME.inventory.pokeballs--;
  // Simple catch chance based on monster HP
  const catchChance = (currentOpponent.maxHp - currentOpponent.currentHp) / currentOpponent.maxHp;
  if (Math.random() < catchChance) {
    // Caught!
    battleTextEl.textContent = `You caught the wild ${currentOpponent.name}!`;
    flashOpponent();
    setTimeout(() => {
      exitBattle(true);
    }, 1000);
  } else {
    battleTextEl.textContent = `Oh no! It escaped the ball!`;
    // Opponent attacks
    setTimeout(() => {
      const enemyDmg = getRandomInt(3, 8);
      GAME.playerMonster.currentHp -= enemyDmg;
      battleTextEl.textContent += ` The wild ${currentOpponent.name} retaliated for ${enemyDmg} damage.`;
      updateHpBar(playerMonsterEl.querySelector('.hp-bar-inner'), GAME.playerMonster.currentHp, GAME.playerMonster.maxHp);
      checkPlayerFainted();
    }, 700);
  }
});

/* Run handler */
btnRun.addEventListener('click', () => {
  if (!GAME.inBattle) return;
  battleTextEl.textContent = `You ran away safely!`;
  setTimeout(() => exitBattle(false), 500);
});

/* Check if opponent fainted */
function checkOpponentFainted() {
  if (currentOpponent.currentHp <= 0) {
    battleTextEl.textContent = `The wild ${currentOpponent.name} fainted!`;
    setTimeout(() => exitBattle(false), 1000);
  }
}

/* Check if player fainted */
function checkPlayerFainted() {
  if (GAME.playerMonster.currentHp <= 0) {
    battleTextEl.textContent = `Your monster fainted! Game Over... (Refreshing your monster HP)`;
    setTimeout(() => {
      GAME.playerMonster.currentHp = GAME.playerMonster.maxHp;
      exitBattle(false);
    }, 1500);
  }
}

/* Exit the battle screen */
function exitBattle(caught) {
  GAME.inBattle = false;
  battleScreenEl.style.display = 'none';
  currentOpponent = null;
  if (!caught) {
    // Just restore the overworld
  }
}

/* Simple random int helper */
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

/* Flash effect when a monster is caught */
function flashOpponent() {
  opponentMonsterEl.classList.add('flash');
  setTimeout(() => {
    opponentMonsterEl.classList.remove('flash');
  }, 1000);
}

/* INITIALIZE TRAINER POSITION */
GAME.trainerPosition.x = 5;
GAME.trainerPosition.y = 5;
updateTrainerPosition();

openDialog('Welcome to the (unofficial) Pokemon-Inspired Mini Game! Walk around and see what you encounter!');
</script>
</body>
</html>
